# Agent Contract Registry
#
# Defines validation requirements and workflow expectations for agent types.
# This configuration is loaded at runtime, allowing dynamic agent registration.
#
# Validation Types:
# - none: No validation required (agent completes work directly)
# - contract: Agent must spawn specific child tasks
# - testing: Agent output must pass automated tests
#
# NOTE: Agents that use prompt chains for orchestration should use validation_type: none
#       since the chain handles workflow internally.

agents:
  # ============================================================================
  # Workflow Orchestration Agents (Chain-Based)
  # ============================================================================

  requirements-gatherer:
    description: "Autonomous requirements analysis and research"
    validation_type: none  # Uses prompt chains for orchestration
    default_chain: technical_feature_workflow
    notes: "Chain mode: Returns requirements JSON. Standalone: Spawns technical-architect"

  # ============================================================================
  # Workflow Orchestration Agents (Task-Spawning)
  # ============================================================================

  technical-architect:
    description: "System architecture and design"
    validation_type: contract
    contract:
      must_spawn_children: true
      min_children: 1
      expected_child_types:
        - technical-requirements-specialist
    notes: "Analyzes requirements and spawns technical specs specialist"

  task-planner:
    description: "Decomposes work into atomic tasks with dependencies"
    validation_type: contract
    contract:
      must_spawn_children: true
      min_children: 1
      expected_child_types: []  # Can spawn any agent type dynamically
    notes: "Determines required specialists and spawns implementation tasks"

  # ============================================================================
  # Implementation Agents (Test-Based Validation)
  # ============================================================================

  # Example of test-based validation (commented out - configure per project)
  # rust-service-layer-specialist:
  #   description: "Implements Rust async service layer"
  #   validation_type: testing
  #   testing:
  #     validator_agent: rust-testing-specialist
  #     test_commands:
  #       - cargo test --lib
  #       - cargo clippy -- -D warnings
  #     worktree_required: true
  #     max_remediation_cycles: 3
  #   notes: "Work must pass tests before merging"

  # ============================================================================
  # Support Agents (No Validation)
  # ============================================================================

  technical-requirements-specialist:
    description: "Creates detailed technical specifications"
    validation_type: none
    notes: "Terminal agent - produces specifications, doesn't spawn children"

  git-worktree-merge-orchestrator:
    description: "Manages git worktree merging with safety checks"
    validation_type: none
    notes: "Terminal agent - performs merge operations"

  git-branch-cleanup-specialist:
    description: "Safely deletes merged branches and cleans worktrees"
    validation_type: none
    notes: "Terminal agent - cleanup operations"

  task-salvage-specialist:
    description: "Recovers from contract validation failures"
    validation_type: none
    notes: "Terminal agent - remediation specialist"

# ============================================================================
# Default Configuration
# ============================================================================

defaults:
  # Default validation for unknown agent types
  validation_type: none

  # Default model preference (can be overridden per agent)
  model: sonnet

  # Default max remediation cycles for testing validation
  max_remediation_cycles: 3

# ============================================================================
# Agent Creation Rules
# ============================================================================

agent_creation:
  # Agents with these patterns should NOT have contracts hardcoded
  # Their validation is determined by project context and task-planner
  dynamic_agents:
    - "rust-*"
    - "python-*"
    - "typescript-*"
    - "go-*"
    - "*-specialist"
    - "*-worker"

  # Validation can be overridden per-task via task metadata
  allow_per_task_override: true
